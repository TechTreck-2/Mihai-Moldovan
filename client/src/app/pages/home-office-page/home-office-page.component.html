<div class="container mat-elevation-z4">
  <div class="map-container">
    <div id="map" class="map"></div>
    <div class="spinner-overlay" *ngIf="loading">
      <mat-spinner></mat-spinner>
    </div>
  </div>

  <div *ngIf="confirmingAddress" class="floating-panel mat-elevation-z8">
    <h3>Add New Office</h3>
    <p class="current-address">
      <mat-icon>place</mat-icon>
      <span>{{ currentAddress }}</span>
    </p>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Office Name</mat-label>
      <input matInput type="text" [(ngModel)]="newOfficeName" placeholder="Enter office name">
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <textarea matInput [(ngModel)]="newOfficeDescription" placeholder="Enter office description" rows="3"></textarea>
    </mat-form-field>

    <p class="location-coordinates" *ngIf="pendingLocation">
      Latitude: {{ pendingLocation.lat!.toFixed(6) }},
      Longitude: {{ pendingLocation.lng!.toFixed(6) }}
    </p>
    <p class="adjust-tip">
      <mat-icon>info</mat-icon>
      <span>Click anywhere on the map to adjust the pin location</span>
    </p>

    <div class="action-buttons">
      <button mat-raised-button color="warn" (click)="cancelAddOffice()">
        Cancel
      </button>
      <button mat-raised-button color="primary" (click)="confirmAddOffice()">
        Add Office
      </button>
    </div>
  </div>
  <mat-card class="office-list">
    <mat-card-title>Offices</mat-card-title>
    <div class="office-items-container">
      <div *ngIf="locations.length <= 0" class="empty-state">
        Nothing here
      </div>
        <div *ngFor="let location of locations" class="office-item mat-elevation-z1" (click)="focusOnLocation(location)">
        <div class="office-details">
          <h3 #addressElement [ngClass]="{'marquee': isOverflowing}">
            <span>{{ location.name }}</span>
          </h3>
          <p class="office-description">{{ location.description }}</p>
          <p class="office-coords">
            Lat: {{ location.lat.toFixed(4) }}, Lng: {{ location.lng.toFixed(4) }}
          </p>
        </div>
        <div class="office-actions" (click)="$event.stopPropagation()">
          <button mat-icon-button color="primary" (click)="editLocation(location)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteLocation(location)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <div class="add-office">
      <h4>Add Office by Address</h4>
      <div class="address-input-container">
        <mat-form-field appearance="outline" class="address-input">
          <mat-label>Enter address</mat-label>
          <input matInput type="text" [(ngModel)]="addressInput" [disabled]="confirmingAddress" />
        </mat-form-field>
        <button mat-raised-button color="accent" (click)="searchAddressByInput()" [disabled]="!addressInput.trim() || confirmingAddress">
          Search
        </button>
      </div>
    </div>

    <div class="add-office">
      <h4>Add Office by Map Click</h4>
      <button mat-raised-button color="primary" (click)="addingByMap = true" [disabled]="addingByMap || confirmingAddress">
        <mat-icon>add_location</mat-icon>
        Click on Map to Add Office
      </button>
    </div>
  </mat-card>
</div>

<div id="tooltip" class="tooltip" style="display: none;"></div>